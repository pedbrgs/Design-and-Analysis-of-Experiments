---
title: |
    | Planejamento e Análise de Experimentos (EEE933)
    | Estudo de Caso 2
#title: Planejamento e Análise de Experimentos (EEE933) Estudo de Caso 1
author: Pedro Vinícius, Samara Silva e Savio Vieira
date: 24 de Agosto de 2020
output:
  pdf_document:
    #latex_engine: xelatex
    fig_caption: yes
  html_document:
    df_print: paged
indent: true
header-includes: 
    - \usepackage{indentfirst}
    - \usepackage{float}
bibliography: ref.bib
doi: https://github.com/pedbrgs/Design-and-Analysis-of-Experiments
pagetitle: Estudo de Caso 2
---

```{r setup, results='hide', warning=FALSE, include = FALSE, message = FALSE, echo=FALSE}
# A few initial definitions just to make sure all required packages are installed. Change as needed.
# NOTE: It may echo some weird messages to the PDF on the first compile (package installation messages). Run twice and the problem will (hopefully) go away. 
if (!require(ggplot2, quietly = TRUE)){
      install.packages("ggplot2")
      }
if (!require(devtools, quietly = TRUE)){
      install.packages("devtools")
}
if (!require(GGally, quietly = TRUE)){
      install.packages("GGally")
      }
 if (!require(broom, quietly = TRUE)){
       devtools::install_github("dgrtwo/broom")
      }
if (!require(stats, quietly = TRUE)){
      suppressMessages(install.packages("stats"))
      }
if (!require(plotly, quietly = TRUE)){
      suppressMessages(install.packages("plotly"))
      }
if (!require(reshape2, quietly = TRUE)){
      suppressMessages(install.packages("reshape2"))
      }
if (!require(tidyr, quietly = TRUE)){
      suppressMessages(install.packages("tidyr"))
      }
```


```{r, message = FALSE, warning = FALSE, results = 'hide', echo = FALSE}
# Statistical package 
library(stats)
# Ggplot2 package
library(ggplot2)
# Plotly package
library(plotly)
# Reshape2 package
library(reshape2)
# GGally package
library(GGally)
# Tidyr package
library(tidyr)
# UFT-8 Encoding
options(Encoding="UTF-8")
```

\renewcommand{\figurename}{Figura}
\renewcommand{\tablename}{Tabela}

# Introdução

\par O Índice de Massa Corporal (IMC) é uma medida de gordura corporal baseada na relação entre peso (em $kg$) e altura (em $m$) de um indivíduo e é comumente utilizado como uma ferramenta de triagem para indicar se uma pessoa está com um peso saudável para sua altura. Este índice é calculado conforme a Equação \ref{eq:imc}:

\begin{equation}
  \label{eq:imc}
  IMC = \frac{peso}{(altura)^2} 
\end{equation}

\noindent em $kg/m^2$. Cada faixa de IMC permite classificar o indivíduo em uma das seguintes categorias \cite{Alexandra2007}:

* Baixo peso: $< 18,5$
* Peso normal: $18,5 - 25$
* Sobrepeso: $25 - 30$
* Obesidade: $30 - 35$
* Obesidade mórbida: $> 40$

Neste estudo de caso deseja-se comparar o IMC médio dos alunos de Pós-Graduação em Engenharia Elétrica (PPGEE) da Universidade Federal de Minas Gerais (UFMG) de dois semestres distintos: $2016/2$ e $2017/2$. Para tal fim, foram disponibilizadas duas amostras, contendo sexo, altura e peso de alguns alunos \cite{Campelo2018-LNDoE}. Assim, duas análises estatísticas independentes são propostas: (i) uma sobre o IMC médio dos alunos do sexo masculino e (ii) uma sobre o IMC médio dos alunos do sexo feminino. Para ambos os casos, a condução dos experimentos foram similares, no entanto, alguns testes tiveram que ser adaptados de acordo com as propriedades das distribuições amostrais investigadas.

## Planejamento dos Experimentos

As hipóteses estatísticas foram definidas com o intuito de responder às questões propostas abaixo:

* Há evidências de que o IMC médio dos alunos do PPGEE/UFMG de $2016/2$ é diferente do IMC médio dos alunos do PPGEE/UFMG de $2017/2$ no que se refere ao sexo masculino?
* E quanto ao sexo feminino?

Em concordância com a proposta de comparação do IMC médio entre os alunos de semestres distintos, as hipóteses de teste podem ser formuladas sobre o parâmetro média:
$$\begin{cases} H_0: \mu_{2016} = \mu_{2017} &\\H_1: \mu_{2016} \neq \mu_{2017} \end{cases}$$
\noindent onde a hipótese nula $H_0$ implica na igualdade entre os IMCs médios dos alunos de $2016/2$ e $2017/2$ e a hipótese alternativa bilateral $H_1$ na diferença dos IMCs médios e, portanto, em uma potencial diferença dos estilos de vida dos alunos.

Os parâmetros experimentais para realização dos testes são:

* A probabilidade admissível de rejeição da hipótese nula quando ela é verdadeira é de apenas $5\%$, isto é, o nível de significância do teste é $\alpha = 0,05$;
* A potência do teste é de $\pi = 1 - \beta = 0,8$. Em outras palavras, deseja-se uma probabilidade de falha ao rejeitar a hipótese nula quando ela é falsa de $20\%$;
* O tamanho de efeito de mínima relevância prática foi definido em $\delta^{*} = 1$, ou seja, pretende-se detectar, a partir do teste de hipóteses, desvios de 1 $kg/m^2$.

## Pré-Processamento dos Dados

Conforme mencionado anteriormente, as bases de dados [imc_20162.csv](https://raw.githubusercontent.com/fcampelo/Design-and-Analysis-of-Experiments/master/data%20files/imc_20162.csv) e [CS01_20172.csv](https://raw.githubusercontent.com/fcampelo/Design-and-Analysis-of-Experiments/master/data%20files/CS01_20172.csv) foram disponibilizadas \cite{Campelo2018-LNDoE}. A amostra relativa ao semestre de $2016/2$ dispõe dos atributos número de identificação do aluno, visto que a coleta manteve o sigilo dos estudantes, curso (graduação ou pós-graduação), gênero, peso (em $kg$) e altura (em $m$). A princípio, foi necessário extrair apenas as informações dos alunos cujo vínculo com a universidade era de discente da pós-graduação e, posteriormente, realizar a fragmentação por gênero, formando duas amostras independentes ($M2016$ e $F2016$). A amostra relativa ao semestre de $2017/2$, por sua vez, compreendia os atributos peso (em $kg$), altura (em $m$), sexo e idade. Além disso, as observações eram somente de alunos da pós-graduação e, portanto, exigiu apenas a separação por gênero em duas outras amostras ($M2017$ e $F2017$).

A partir dos pesos e alturas disponíveis, os índices de massa corporal foram calculados para cada aluno, conforme a Equação \ref{eq:imc}. Por fim, as observações de interesse foram compiladas em uma única estrutura de dados. Os 10 primeiros IMCs de cada amostra podem ser visualizados abaixo, onde os valores "NA" presentes nas amostras femininas ($F2016$ e $F2017$) indicam que ambas possuem tamanho amostral $N < 10$, isto é, 7 e 4 observações, respectivamente. As amostras masculinas ($M2016$ e $M2017$), no entanto, apresentam 21 observações cada uma.

```{r, results = 'hide', echo = FALSE}
# Carrega dados relativos ao semestre de 2016/2
data2016 <- read.csv('imc_20162.csv')
# Seleciona apenas alunos do programa de pós-graduação
ppgee2016 <- data2016[data2016['Course'] == 'PPGEE',]
# Separa amostras por sexo
female2016 <- ppgee2016[ppgee2016['Gender'] == 'F',]
male2016 <- ppgee2016[ppgee2016['Gender'] == 'M',]
```

```{r, results = 'hide', echo = FALSE}
# Carrega dados relativos ao semestre de 2017/2
data2017 <- read.csv('CS01_20172.csv', sep = ';')
# Separa amostras por sexo
female2017 <- data2017[data2017['Sex'] == 'F',]
male2017 <- data2017[data2017['Sex'] == 'M',]
```

```{r, results = 'hide', echo = FALSE}
# Cálculo do Índice de Massa Corporal (IMC)

# Alunos de 2016/2
female2016['IMC.kg/m2'] <- female2016['Weight.kg']/(female2016['Height.m']^2)
male2016['IMC.kg/m2'] <- male2016['Weight.kg']/(male2016['Height.m']^2)

# Alunos de 2017/2
female2017['IMC.kg/m2'] <- female2017['Weight.kg']/(female2017['height.m']^2)
male2017['IMC.kg/m2'] <- male2017['Weight.kg']/(male2017['height.m']^2)
```

```{r, results = 'hide', echo = FALSE}

# Amostras de 2016/2
F2016 <- female2016$`IMC.kg/m2`
M2016 <- male2016$`IMC.kg/m2`

# Amostras de 2017/2
F2017 <- female2017$`IMC.kg/m2`
M2017 <- male2017$`IMC.kg/m2`
```

```{r, results = 'hide', echo = FALSE}
n_max <- max(length(F2016), length(F2017), length(M2016), length(M2017))
length(F2016) <- n_max
length(F2017) <- n_max
length(M2016) <- n_max
length(M2017) <- n_max

IMCs <- data.frame('M2016' = M2016, 'M2017' = M2017, 'F2016' = F2016, 'F2017' = F2017)
```

```{r, fig.align = 'center', fig.pos = 'H'}
# 10 primeiras observações de cada amostra
show(IMCs[c(1:10),])
```

## Análise Exploratória de Dados

```{r, results = 'hide', echo = FALSE}
IMCs <- melt(IMCs, id.vars = NULL)
IMCs <- na.omit(IMCs)
```

```{r histogram, fig.height = 3, fig.width = 4, fig.align = 'center', fig.cap = 'Histogramas.', fig.pos = 'H'}
# Histogram
ggplot(IMCs, aes(value)) + xlab(expression("IMC (kg/"*"m"^2*")")) + 
    ylab("Frequência") + geom_histogram(bins = 20) + 
    facet_wrap(~variable, scales = 'free')
```

```{r boxplot, fig.height = 3, fig.width = 4, fig.align = 'center', fig.cap = 'Boxplots.', fig.pos = 'H'}
# Boxplot
ggplot(data = IMCs, aes(y = "", x = value)) + xlab(expression("IMC (kg/"*"m"^2*")")) + 
    ylab("") + geom_boxplot(lwd = 0.3) + 
    facet_wrap(~variable, scales = 'free') + coord_flip()
```


```{r qqplot, fig.height = 3, fig.width = 4, fig.align = 'center', fig.cap = 'QQ-Plots', fig.pos = 'H'}
# QQ-Plots
ggplot(data = IMCs, aes(sample = value)) +
  facet_wrap(~variable, scales = "free") +
  stat_qq() + stat_qq_line() + scale_y_continuous(name = 'Quantis da Amostra') + 
  scale_x_continuous(name = 'Quantis Teóricos Normais')
```


## Análise Estatística
Uma vez analisado a normalidade das amostras, pode-se definir quais testes são aplicáveis para comparação das medias. Para as observações do IMC masculino, tanto a amostra do segundo semestre de $2016$ quando a do segundo semestre de $2017$ são normais, sendo assim, pode-se aplicar o teste T de Student para duas amostras. Porem, para as observações do IMC feminino, a amostra do segundo semestre de $2017$ não é normal, sendo assim, para teste das medias das amostras do grupo feminino, deve-se utilizar um teste não-paramétrico.
O teste T de Student para duas amostras tem como premissa que as amostras a serem testadas tenham comportamento normal, como já mencionado. Os parâmetros de entrada, além das duas amostras envolvidas, devem conter que tipo da hipótese alternativa, se bilateral, unilateral esquerda ou direita, neste experimento, deseja-se que as medias tenham valores diferentes, sendo assim, bilateral. Outro parâmetro de entrada é o valor da diferença das medias, neste caso, como a hipótese nula é que as medias das duas amostras são iguais, a diferença das medias $\mu_{2016} - \mu_{2017} = 0$, e por fim, o nível de confiança adotado para os testes foi de $95\%$.


```{r}
(t_test <- t.test(x = M2016, 
                  y = M2017,
                alternative = "two.sided",
                conf.level = 0.95))
cat('Intervalo de confiança:', t_test$conf.int[1:2])
```
O resultado do teste T de Student retornou um p-valor de $0,5925$, maior que o nível de significância de $0,05$, isso significa que com $95\%$ de confiança, não deve-se rejeitar a hipótese nula $H_0$ de que as medias das duas amostras são iguais. Sendo a hipótese alternativa $H_1$ bilateral, o intervalo de confiança para a diferença das medias é [-1,788823 , 3,089716].

O teste de Wilcoxon foi apontado para analise das amostras do grupo feminino, por uma das amostras não ser normal. É um teste não-paramétrico, equivalente ao teste Mann-Whitney quando as amostras não são pareadas. A hipótese nula $H_0$ é de que as medias são iguais, sendo assim, o que nos parâmetro do teste de Wilcoxon chama-se de mudança de localização, o valor deve ser igual a zero ($0$), como padrão o mesmo já é zero. A hipótese alternativa $H_1$ é de que as medias são diferentes, um teste bilateral, e o nivel de confiança para o teste tambem é de $95\%$.
```{r}
(wilcox_test <- wilcox.test(x = F2016, 
                            y = F2017, 
                            alternative = "two.sided", 
                            conf.int = TRUE))
cat('Intervalo de confiança:', wilcox_test$conf.int)
```
Como o p-valor retornado foi maior que o nível de significância do experimento, $0,07273 > 0,05$, a hipótese nula $H_0$, com $95\%$ de confiança, não pode ser rejeitada. O intervalo de confiança para a diferença das medias é [-0,6374374, 5,22844].
Para os testes tanto do grupo masculino quanto para o feminino, as hipóteses nulas $H_0$ foram aceitas, neste caso, hipóteses fracas que não foram rejeitadas. Não significa que são verdadeiras, mas que com os testes realizados a $95\%$  de confiança, não pode-se rejeitá-las.


## Validação de Premissas

```{r}
shapiro.test(M2016)
shapiro.test(M2017)
```

```{r}
shapiro.test(F2016)
shapiro.test(F2017)
```


## Conclusões


### Discussão de Melhorias


### Atividades Desempenhadas



\renewcommand\refname{Referências}
\bibliographystyle{plain}
\bibliography{ref}